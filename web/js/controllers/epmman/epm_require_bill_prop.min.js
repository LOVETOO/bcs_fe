define(["module","controllerApi","base_obj_prop","dateApi","controllers/epmman/epmman","requestApi","swalApi"],function(module,controllerApi,base_obj_prop,dateApi,epmman,requestApi,swalApi){EPMRequireBillProp.$inject=["$scope"];function EPMRequireBillProp($scope){controllerApi.extend({controller:base_obj_prop.controller,scope:$scope});$scope.gridOptions={columnDefs:[{type:"序号"},{field:"item_code",headerName:"产品编码"},{field:"item_name",headerName:"产品名称"},{field:"entorgid",headerName:"产品线",hcDictCode:"entorgid"},{field:"item_model",headerName:"型号"},{field:"qty_bill",headerName:"申请数量",type:"数量",onCellValueChanged:function(params){console.log("onCellValueChanged",params)}},{field:"price_bill",headerName:"标准单价(元)",type:"金额"},{field:"contract_price",headerName:"工程方单价(元)",type:"金额",hide:true},{field:"discount_rate",headerName:"应用折扣率"},{field:"discounted_price",headerName:"折后单价(元)",type:"金额"},{field:"discounted_amount",headerName:"折后金额",type:"金额"},{field:"spec",headerName:"规格"},{field:"item_color",headerName:"颜色"},{field:"cubage",headerName:"体积(m³)",type:"体积"},{field:"weight",headerName:"重量(kg)"},{field:"total_volume",headerName:"总体积(m³)",type:"体积"},{field:"total_weight",headerName:"总重量(kg)"},{field:"unit",headerName:"单位"},{field:"is_cancel",headerName:"取消",type:"是否"},{field:"remark",headerName:"备注"}]};$scope.commonSearch={discount_apply_code:{postData:function(){return{search_flag:2,customer_id:customer?customer.customer_id:0}},beforeOk:function(discount_apply){return requestApi.post({classId:"sa_out_bill_head",action:"get_data_by_epm_discount_apply",data:{discount_apply_id:discount_apply.discount_apply_id}}).then(function(require_bill){if(require_bill.error){swalApi.error(require_bill.error);throw require_bill.error}return require_bill})},afterOk:function(require_bill){["discount_apply_id","discount_apply_code","discount_valid_date","discount_type","discount_rate","order_pdt_line","customer_id","customer_code","customer_name","take_man","phone_code","customer_address_id","address","project_id","project_code","project_name","stage_id","stage_name","contract_id","contract_code","contract_name","contract_expire_date","contract_type","trading_company_id","trading_company_name","billing_unit_id","billing_unit_name","sa_out_bill_lines"].forEach(function(key){$scope.data.currItem[key]=require_bill[key]});$scope.gridOptions.hcApi.setRowData($scope.data.currItem.sa_out_bill_lines)}}};$scope.newBizData=function(bizData){$scope.hcSuper.newBizData(bizData);bizData.division_id=epmman.getDivision().division_id;bizData.date_invbill=dateApi.today();bizData.created_by=user.userid;bizData.bill_type=1;bizData.channel=1;bizData.deductions_way=1;bizData.created_source=1;if(customer){["customer_id","customer_code","customer_name","take_man","phone_code","customer_address_id","address"].forEach(function(key){bizData[key]=customer[key]})}}}return controllerApi.controller({module:module,controller:EPMRequireBillProp})});