define(["exports","angular","Decimal"],function(api,angular,Decimal){var ZERO=Decimal("0"),ONE=Decimal("1");api.isNaN=function(n){return n!==n};api.toNumber=function(target,failReturn){if(angular.isString(target)&&target.indexOf(",")!==-1){target=target.replace(/,/g,"")}var n=Number(target);if(api.isNaN(n))n=api.toNumber(failReturn,0);return n};function toDecimal(target,failReturn){if(!failReturn)failReturn=ZERO;if(typeof target==="string"&&target.indexOf(",")>-1)target=target.replace(/,/g,"");try{return Decimal(target)}catch(e){return failReturn}}api.toMoney=function(value){if(value===undefined||value===null){return""}if(value!==value){return"非法的数字格式: "+value}var type=typeof value,isString=type==="string",isNumber=type==="number";if(!isString&&!isNumber){return"非法的数字格式: "+value}if(isString){value=value.replace(",",".")}var scale=2,result=Decimal(value).toFixed(scale),charArray=Array.prototype.slice.call(result),start=charArray.length-scale-2,end=charArray[0]==="-"?1:0,digits=0,i;for(i=start;i>end;i--){digits++;if(digits===3){digits=0;charArray.splice(i,0,",")}}result=charArray.join("");return result};api.isStrOfNum=function(any){return angular.isString(any)&&/^-?\d{1,3}(,?\d{3})*(\.\d+)?$/.test(any)};api.isNum=function(any){return angular.isNumber(any)&&any===any};api.isInt=function(any){return api.isNum(any)&&any%1===0};api.sum=function(){var numbers;if(angular.isArray(arguments[0])){var key=arguments[1];if(angular.isString(key)){var objs=arguments[0];numbers=objs.map(function(obj){return obj[key]})}else{numbers=arguments[0]}}else{numbers=Array.prototype.slice.call(arguments)}if(numbers.length===0)return 0;var decimals=numbers.map(function(number){return toDecimal(number)});return+decimals.reduce(function(result,currDecimal){return result.add(currDecimal)})};api.mutiply=function(){var numbers;if(angular.isArray(arguments[0])){var key=arguments[1];if(angular.isString(key)){var objs=arguments[0];numbers=objs.map(function(obj){return obj[key]})}else{numbers=arguments[0]}}else{numbers=Array.prototype.slice.call(arguments)}if(numbers.length===0)return 0;var decimals=numbers.map(function(number){return toDecimal(number)});return+decimals.reduce(function(result,currDecimal){return result.mul(currDecimal)})};api.equal=function(field1,field2){return api.compare(field1,field2)==0?true:false};api.notEqual=function(field1,field2){return!api.equal(field1,field2)};api.compare=function(field1,field2){field1=toDecimal(field1);field2=toDecimal(field2);return field1.cmp(field2)};api.sub=function(field1,field2){field1=toDecimal(field1);field2=toDecimal(field2);return+field1.sub(field2)};api.divide=function(field1,field2){try{field1=toDecimal(field1);field2=toDecimal(field2,ONE);return+field1.div(field2)}catch(error){console.log(error);return 0}};api.inttobin=function(intvar,len){var strbin=api.toNumber(intvar).toString(2);if(len&&strbin&&strbin.length<len){var num=len-strbin.length;for(var i=0;i<num;i++){strbin="0"+strbin}}return strbin};api.bintoint=function(binvar){return parseInt(binvar,2)};api.moneyToRMB=function(money){if(api.isNum(money)||api.isStrOfNum(money)){return convertCurrency(money)}return money;function convertCurrency(money){var cnNums=new Array("零","壹","贰","叁","肆","伍","陆","柒","捌","玖");var cnIntRadice=new Array("","拾","佰","仟");var cnIntUnits=new Array("","万","亿","兆");var cnDecUnits=new Array("角","分","毫","厘");var cnInteger="整";var cnIntLast="元";var maxNum=1e15;var integerNum;var decimalNum;var chineseStr="";var parts;if(money==""){return""}money=api.toNumber(money);if(money>=maxNum){return""}if(money==0){chineseStr=cnNums[0]+cnIntLast+cnInteger;return chineseStr}money=money.toString();if(money.indexOf(".")==-1){integerNum=money;decimalNum=""}else{parts=money.split(".");integerNum=parts[0];decimalNum=parts[1].substr(0,4)}if(parseInt(integerNum,10)>0){var zeroCount=0;var IntLen=integerNum.length;for(var i=0;i<IntLen;i++){var n=integerNum.substr(i,1);var p=IntLen-i-1;var q=p/4;var m=p%4;if(n=="0"){zeroCount++}else{if(zeroCount>0){chineseStr+=cnNums[0]}zeroCount=0;chineseStr+=cnNums[parseInt(n)]+cnIntRadice[m]}if(m==0&&zeroCount<4){chineseStr+=cnIntUnits[q]}}chineseStr+=cnIntLast}if(decimalNum!=""){var decLen=decimalNum.length;for(var i=0;i<decLen;i++){var n=decimalNum.substr(i,1);if(n!="0"){chineseStr+=cnNums[Number(n)]+cnDecUnits[i]}}}if(chineseStr==""){chineseStr+=cnNums[0]+cnIntLast+cnInteger}else if(decimalNum==""){chineseStr+=cnInteger}return chineseStr}}});